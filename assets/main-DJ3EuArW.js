import{c as T,a as y}from"./syncStore-B1xeZtas.js";function g(e){const t=[...e];for(let r=t.length-1;r>0;r--){const d=Math.floor(Math.random()*(r+1));[t[r],t[d]]=[t[d],t[r]]}return t}function E(e,t){if(t>e.length)throw new Error(`Cannot pick ${t} items from array of length ${e.length}`);const r=[...e];return g(r).slice(0,t)}function L(e){const t=e*e,r=Math.ceil(t/3),d=r-1,s=t-(r+d+1),f=Math.random()<.5?"red":"blue",i=[];for(let c=0;c<t;c++)c<r?i.push("red"):c<r+d?i.push("blue"):c<r+d+s?i.push("neutral"):i.push("assassin");return{roles:g(i),startsFirst:f}}function C({size:e,words:t}){const r=e*e,d=E(t,r),l=L(e),s=l.roles,f=l.startsFirst;let i=1;const c={};return s.forEach((m,n)=>{m==="neutral"&&(c[n]=i++)}),{cells:d.map((m,n)=>({word:m,row:Math.floor(n/e),col:n%e,role:s[n],neutralNumber:c[n]||null,revealed:!1})),startsFirst:f}}const h={red:"blue",blue:"red"};function O(e,t){if(e.gameOver)return e;const r=e.cells[t];if(r.revealed)return e;const d=e.cells.map((f,i)=>i===t?{...f,revealed:!0}:f);if(r.role==="assassin")return{...e,cells:d,gameOver:!0,winner:h[e.activeTeam]};const s=r.role===e.activeTeam?e.activeTeam:h[e.activeTeam];return{...e,cells:d,activeTeam:s}}function S(e){return e.gameOver?e:{...e,activeTeam:h[e.activeTeam]}}function N(e){if(e.gameOver)return e.winner;const t=e.cells.filter(s=>s.role==="red"&&s.revealed).length,r=e.cells.filter(s=>s.role==="blue"&&s.revealed).length,d=e.cells.filter(s=>s.role==="red").length,l=e.cells.filter(s=>s.role==="blue").length;return t===d?"red":r===l?"blue":null}const k=["абзац","абонент","абрикос","авангард","август","автобус","автор","адрес","академик","аквариум","актер","алмаз","альбом","анализ","ангел","анекдот","апельсин","аппарат","апрель","арбуз","аргумент","аромат","артист","архив","аспект","астроном","аэропорт","багаж","базар","баланс","балкон","банк","барабан","барьер","баскетбол","батарея","башня","бегемот","берег","бетон","билет","бинокль","бизнес","блеск","блок","блокнот","блюдо","богатство","боец","бокал","болт","борщ","ботинок","бочка","брак","брат","бревно","бренд","броня","брус","бугор","букет","бумага","бункер","буря","бутылка","бык","вагон","валенок","валюта","вампир","вариант","ваза","вахта","ведро","век","ветер","вечер","взгляд","вилка","виноград","вирус","вишня","вклад","власть","внук","вода","воздух","вопрос","воск","восток","впечатление","врач","время","вулкан","выбор","вывод","газ","галерея","гараж","гармония","герой","гитара","глава","глаз","глина","гнев","гнездо","город","гора","горизонт","гость","градус","грамота","гранит","график","гроза","группа","груша","губа","давление","дверь","двигатель","двор","дедушка","действие","декан","дело","день","дерево","дефект","диалог","диван","директор","диск","договор","дождь","доклад","доктор","долг","дом","дорога","доска","доставка","друг","дружба","дуб","дума","дым","дыхание","еда","еж","желание","железо","жена","журнал","забор","завод","загадка","закон","зал","замок","запах","запас","заявление","звезда","звонок","здание","земля","зерно","зима","знак","золото","зонт","игра","идея","известие","изделие","изображение","имя","интерес","инструмент","июль","кабинет","кабель","кадр","казак","камень","канал","канат","капитан","капля","карман","картина","касса","каталог","квартира","кедр","кепка","кирпич","кисть","клавиша","класс","клетка","клиент","клуб","ключ","книга","ковер","код","кожа","колесо","коллекция","колокол","команда","комедия","комната","компьютер","конверт","конкурс","контакт","контроль","конфликт","концерт","корень","корзина","коридор","корм","корона","костюм","кот","кофе","кошка","кран","кредит","кресло","крест","крик","кровать","круг","крыло","крыша","куб","кукла","кулак","курс","кусок","куст","лампа","лес","лестница","лето","лидер","лист","лифт","лицо","лодка","ложка","локоть","луна","луч","магазин","май","мак","малина","мама","март","масло","мастер","машина","мебель","мед","медведь","месяц","металл","метод","меч","миг","микрофон","минута","мир","модель","мозг","молоко","молот","момент","монастырь","море","мост","мотор","музей","музыка","муж","мыло","мысль","мясо","набор","народ","насос","наука","начало","небо","неделя","нож","номер","нос","ночь","обед","облако","образ","обувь","огонь","одежда","озеро","океан","окно","операция","опыт","орех","оружие","остров","ответ","отец","охота","ошибка","пакет","палец","память","папа","парк","парта","паспорт","пейзаж","пена","песок","песня","печь","пиджак","пирог","письмо","план","платформа","плечо","площадь","победа","повод","погода","подарок","подвал","подушка","поезд","пожар","покупка","поле","полка","полёт","польза","помощь","понедельник","порт","портфель","посёлок","поток","потолок","праздник","предмет","пример","принцип","природа","причина","программа","продукт","проект","процесс","профессия","птица","путь","пчела","работа","радио","разговор","размер","ракета","рана","рассказ","ребёнок","река","ремонт","ресурс","речь","решение","рис","рисунок","робот","родина","роза","рот","рубль","рука","руководство","рынок","сад","самолёт","сапог","сахар","свет","свобода","село","семья","сентябрь","сердце","сигнал","сила","система","скала","склад","скорость","слово","слон","служба","смысл","снег","собака","собрание","совет","сок","солдат","солнце","сообщение","сосед","состав","состояние","спина","спорт","способ","спутник","среда","станция","стекло","стена","стол","страна","страх","стрела","студент","суббота","суд","сумка","сцена","счастье","сыр","театр","телефон","тело","тема","тетрадь","товар","ток","толпа","трава","трактор","транспорт","тренер","труд","туман","турист","угол","удар","улица","улыбка","ум","урок","успех","утро","фактор","фамилия","февраль","фильм","флот","форма","фраза","фрукт","футбол","характер","хлеб","хозяин","цвет","цель","центр","цепь","церковь","цех","цикл","цифра","чай","человек","четверг","число","член","чудо","шаг","шапка","шар","шахта","школа","шоколад","шум","щека","экзамен","экран","электрик","энергия","эпоха","этаж","юмор","юрист","яблоко","январь","язык","ящик"];function M(){const e=document.createElement("div");e.className="turn-modal",e.innerHTML=`
    <div class="turn-modal__content">
      <div class="turn-modal__text">Ooups! Get ready</div>
      <div class="turn-modal__team"></div>
      <div class="turn-modal__timer">3</div>
      <div class="turn-modal__text">Good luck!!</div>
    </div>
  `,document.body.appendChild(e);let t=null,r=null;function d(l,s){const f=e.querySelector(".turn-modal__content"),i=e.querySelector(".turn-modal__team"),c=e.querySelector(".turn-modal__timer");f.classList.remove("turn-modal__content--red","turn-modal__content--blue"),i.classList.remove("turn-modal__team--red","turn-modal__team--blue"),f.classList.add(`turn-modal__content--${l}`),i.classList.add(`turn-modal__team--${l}`),i.textContent=l==="red"?"RED":"BLUE",e.classList.add("turn-modal--visible");let u=3;c.textContent=u,r&&clearInterval(r),t&&clearTimeout(t),r=setInterval(()=>{u-=1,c.textContent=u},1e3),t=setTimeout(()=>{clearInterval(r),e.classList.remove("turn-modal--visible"),s&&s()},3e3)}return{show:d}}function w({size:e=5}={}){const t=T();let r=0;function d(){r+=1;const{cells:a,startsFirst:o}=C({size:e,words:k});return{gameId:r,size:e,cells:a,activeTeam:o,startingTeam:o,gameOver:!1,winner:null}}let l=t.getState()||d();const s=y(),f=M();let i=null;function c(){i&&(u(i),i=null)}function u(a){const o=N(a);o&&(a={...a,gameOver:!0,winner:o}),l=a,t.setState(l),s.emit(l)}t.subscribe(a=>{JSON.stringify(l)!==JSON.stringify(a)&&(l=a,s.emit(l))});function m(a){if(l.gameOver)return;const o=O(l,a);o.activeTeam!==l.activeTeam?(i=o,f.show(o.activeTeam,c)):u(o)}function n(){l.gameOver||(i=S(l),f.show(i.activeTeam,c))}function v(){u(d())}return{getState:()=>({...l}),subscribe:s.subscribe,reveal:m,endTurn:n,reset:v}}function q({container:e,store:t}){e.innerHTML=`
    <header class="header">
      <div class="header__left">
        <div class="header__team-container">
          <span class="header__team-label">TEAM</span>
          <div class="header__team"></div>
        </div>
      </div>
      <div class="header__right">
        <button class="header__button header__button--menu">QR</button>
        <button class="header__button header__button--turn">END TURN</button>
        <button class="header__button header__button--new">NEW GAME</button>
      </div>
    </header>
  `;const r=e.querySelector(".header__team"),d=e.querySelector(".header__button--new"),l=e.querySelector(".header__button--turn"),s=e.querySelector(".header__button--menu");function f(){const u=document.querySelector(".modal-overlay");u&&u.remove();const m=document.createElement("div");m.className="modal-overlay",m.innerHTML=`
      <div class="modal">
        <div class="modal__header">
          <h2 class="modal__title">MENU</h2>
          <button class="modal__close">✕</button>
        </div>
        <div class="modal__content">
          <p>⚡ Модалка-заглушка ⚡</p>
          <p>Тут буде меню гри</p>
        </div>
        <div class="modal__footer">
          <button class="modal__button modal__button--primary">OK</button>
        </div>
      </div>
    `,document.body.appendChild(m),setTimeout(()=>{m.classList.add("active")},10);function n(){m.classList.remove("active"),setTimeout(()=>{m.remove()},300)}const v=m.querySelector(".modal__close"),a=m.querySelector(".modal__button");v.addEventListener("click",n),a.addEventListener("click",n),m.addEventListener("click",_=>{_.target===m&&n()});const o=_=>{_.key==="Escape"&&(n(),document.removeEventListener("keydown",o))};document.addEventListener("keydown",o)}function i(u){var m;u&&(u.gameOver?r.textContent=`${(m=u.winner)==null?void 0:m.toUpperCase()} WINS!`:r.textContent=u.activeTeam==="red"?"RED":"BLUE",document.body.classList.remove("team-red","team-blue"),!u.gameOver&&u.activeTeam&&document.body.classList.add(`team-${u.activeTeam}`))}function c(u){i(u)}d.addEventListener("click",()=>{t.reset()}),l.addEventListener("click",()=>{t.getState().gameOver||t.endTurn()}),s.addEventListener("click",f),t.subscribe(c),i(t.getState())}function p(e){const t=e.length;return t<=4?"52px":t<=8?"44px":t<=10?"40px":t<=12?"36px":"28px"}function R({container:e,store:t}){const r=document.createElement("div");r.className="grid",e.innerHTML="",e.appendChild(r);const d=new Map;function l(n,v){const a="grid__cell";let o;if(!v.revealed)o="grid__cell--hidden";else switch(v.role){case"red":o="grid__cell--red";break;case"blue":o="grid__cell--blue";break;case"neutral":o="grid__cell--neutral";break;case"assassin":o="grid__cell--assassin";break;default:o="grid__cell--hidden"}n.className=`${a} ${o}`,n.dataset.role=v.role,v.role==="neutral"&&v.neutralNumber&&v.revealed&&n.classList.add(`grid__cell--neutral-${v.neutralNumber}`),n.dataset.revealed=String(v.revealed),n.dataset.neutralNumber=v.neutralNumber||"",n.style.fontSize=p(v.word)}function s(n,v){const a=document.createElement("button");return a.className="grid__cell grid__cell--hidden",a.dataset.index=v,a.dataset.role=n.role,a.dataset.revealed="false",a.dataset.neutralNumber=n.neutralNumber||"",a.textContent=n.word,a.style.fontSize=p(n.word),a.style.wordBreak="break-word",a.style.hyphens="auto",a.addEventListener("click",()=>{t.reveal(v)}),a}function f(n){r.innerHTML="",d.clear(),n.cells.forEach((v,a)=>{const o=s(v,a);r.appendChild(o),d.set(a,o)})}function i(n,v){n.cells.forEach((a,o)=>{const _=v.cells[o],b=d.get(o);!b||!(_.revealed!==a.revealed||_.neutralNumber!==a.neutralNumber||_.role!==a.role||_.word!==a.word)||(_.word!==a.word&&(b.textContent=a.word),l(b,a))})}let c=null;function u(n){if(!c){f(n),c=n,n.gameOver&&r.classList.add("game-over");return}if(n.gameId!==c.gameId){f(n),c=n,n.gameOver?r.classList.add("game-over"):r.classList.remove("game-over");return}i(n,c),n.gameOver!==c.gameOver&&(n.gameOver?r.classList.add("game-over"):r.classList.remove("game-over")),c=n}const m=t.subscribe(u);return u(t.getState()),()=>{m(),d.clear()}}function x({root:e,store:t}){e.innerHTML=`
    <div class="app">
      <div class="app__header"></div>
      <div class="app__grid"></div>
    </div>
  `,q({container:e.querySelector(".app__header"),store:t}),R({container:e.querySelector(".app__grid"),store:t})}document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("#app");if(!e){console.error("Root element #app not found");return}const t=w({size:5});x({root:e,store:t})});
