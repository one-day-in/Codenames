import{s as l}from"./url-CeekiTZl.js";const _=3e4,o={GUIDE_RESONANT:"guide-resonant",GUIDE_DISSONANT:"guide-dissonant",WALKER_RESONANT:"walker-resonant",WALKER_DISSONANT:"walker-dissonant"},O=Object.values(o);function p(S){let t=null,r={},c={};function E(){return{[o.GUIDE_RESONANT]:!1,[o.GUIDE_DISSONANT]:!1,[o.WALKER_RESONANT]:!1,[o.WALKER_DISSONANT]:!1}}function i(){if(!t)return E();const n=t.presenceState(),e=E();return Object.values(n).forEach(a=>a.forEach(s=>{s.role in e&&(e[s.role]=!0)})),e}function u(){var e;const n=i();(e=r.onChange)==null||e.call(r,n,O.every(a=>n[a]))}function N(n){t||(t=l.channel("presence-"+S,{config:{presence:{key:n||"host"}}}),t.on("presence",{event:"join"},({key:e})=>{c[e]&&(clearTimeout(c[e]),delete c[e]),u()}).on("presence",{event:"leave"},({key:e})=>{c[e]=setTimeout(()=>{delete c[e],u()},_)}).subscribe(async e=>{e==="SUBSCRIBED"&&n&&(await t.track({role:n}),u())}))}async function T(n){return new Promise(e=>{const a="check-"+S+"-"+Date.now(),s=l.channel(a);let h=!1;function A(f){h||(h=!0,l.removeChannel(s),e(f))}s.on("presence",{event:"sync"},()=>{const f=Object.values(s.presenceState()).some(v=>v.some(m=>m.role===n));A(f)}).subscribe(),setTimeout(()=>A(!1),5e3)})}function R(){t&&(t.untrack(),l.removeChannel(t),t=null),Object.values(c).forEach(clearTimeout),c={}}return{listen:()=>N(null),join:n=>N(n),leave:R,onChange:n=>{r.onChange=n},getPresenceState:i,allConnected:()=>O.every(n=>i()[n]),isRoleTaken:T}}export{O as A,o as R,p as c};
